<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaloTrack - AI-Powered Food Scanner</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --primary: #10b981;
            --primary-hover: #059669;
            --primary-light: #d1fae5;
            --secondary: #6366f1;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text: #1a1a1a;
            --text-light: #666;
            --border: #e8e8e8;
            --bg: #f0fdf4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 10%, rgba(239, 68, 68, 0.08) 0%, transparent 25%),
                radial-gradient(circle at 90% 15%, rgba(16, 185, 129, 0.08) 0%, transparent 25%),
                radial-gradient(circle at 15% 85%, rgba(16, 185, 129, 0.08) 0%, transparent 25%),
                radial-gradient(circle at 85% 90%, rgba(99, 102, 241, 0.06) 0%, transparent 25%);
            z-index: 0;
            pointer-events: none;
        }

        .food-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
            opacity: 0.15;
        }

        .food-item {
            position: absolute;
            font-size: 3em;
            animation: float-item 20s infinite;
        }

        .food-item:nth-child(1) { top: 10%; left: 5%; animation-delay: 0s; }
        .food-item:nth-child(2) { top: 20%; right: 10%; animation-delay: 2s; }
        .food-item:nth-child(3) { top: 40%; left: 15%; animation-delay: 4s; }
        .food-item:nth-child(4) { top: 60%; right: 20%; animation-delay: 6s; }
        .food-item:nth-child(5) { top: 75%; left: 25%; animation-delay: 8s; }

        @keyframes float-item {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.15; }
            50% { transform: translateY(-30px) rotate(10deg); opacity: 0.25; }
        }

        #login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(16, 185, 129, 0.15);
            max-width: 450px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 20%, #fbbf24 40%, #10b981 60%, #6366f1 80%, #8b5cf6 100%);
        }

        .login-header {
            padding: 40px 40px 30px;
            text-align: center;
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.7) 0%, rgba(255, 255, 255, 0.95) 100%);
        }

        .login-logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary) 0%, #34d399 100%);
            border-radius: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.25);
        }

        .login-header h1 {
            font-size: 1.8em;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .login-header p {
            font-size: 0.9em;
            color: var(--text-light);
        }

        .login-body {
            padding: 40px;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 10px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }

        .auth-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 0.9em;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.95em;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
            color: var(--text);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            background: var(--primary);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-top: 8px;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 1px solid var(--border);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 0.85em;
            width: auto;
            margin: 0;
        }

        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        .info-box {
            padding: 16px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
            border-radius: 10px;
            border-left: 3px solid #6366f1;
            margin-top: 20px;
            font-size: 0.85em;
            color: #4f46e5;
        }

        #main-app {
            display: none;
        }

        .container {
            max-width: 800px;
            margin: 40px auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(16, 185, 129, 0.15);
            position: relative;
            z-index: 10;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 20%, #fbbf24 40%, #10b981 60%, #6366f1 80%, #8b5cf6 100%);
            z-index: 2;
        }

        .header {
            padding: 60px 40px 40px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.7) 0%, rgba(255, 255, 255, 0.95) 100%);
            position: relative;
            overflow: hidden;
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .user-info strong {
            color: var(--primary);
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary) 0%, #34d399 100%);
            border-radius: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.25);
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 2em;
            font-weight: 600;
            letter-spacing: -0.5px;
            color: var(--text);
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 0.95em;
            color: var(--text-light);
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        .health-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            padding: 8px 20px;
            background: rgba(16, 185, 129, 0.12);
            border-radius: 20px;
            font-size: 0.85em;
            color: var(--primary);
            font-weight: 500;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .content {
            padding: 40px;
            background: white;
            position: relative;
        }

        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 40px;
            overflow-x: auto;
        }

        .tab {
            padding: 16px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 0.9em;
            font-weight: 500;
            color: #999;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .section-subtitle {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 24px;
        }

        .profile-reminder {
            padding: 16px 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
            border-radius: 10px;
            border-left: 3px solid #6366f1;
            margin-bottom: 24px;
            font-size: 0.9em;
        }

        .profile-reminder strong {
            color: #4f46e5;
        }

        .camera-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 24px 0;
        }

        .camera-option {
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.5) 0%, white 100%);
            padding: 32px 24px;
            border-radius: 12px;
            border: 2px solid rgba(16, 185, 129, 0.1);
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .camera-option:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.8) 0%, white 100%);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.15);
        }

        .camera-option-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
        }

        .camera-option h3 {
            font-size: 1em;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .camera-option p {
            font-size: 0.85em;
            color: var(--text-light);
        }

        .results {
            display: none;
            padding: 24px;
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.3) 0%, rgba(255, 255, 255, 0.9) 100%);
            border-radius: 12px;
            margin-top: 24px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .results.active {
            display: block;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, #34d399 100%);
            color: white;
            padding: 32px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.25);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: 'üí™';
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 3em;
            opacity: 0.2;
        }

        .stat-card h3 {
            font-size: 2.8em;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .stat-card p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .warning {
            padding: 18px 24px;
            border-radius: 10px;
            margin: 16px 0;
            font-size: 0.95em;
            border-left: 4px solid;
        }

        .warning.success {
            background: #f0fdf4;
            border-left-color: var(--success);
            color: #065f46;
        }

        .warning.warning {
            background: #fef3c7;
            border-left-color: var(--warning);
            color: #92400e;
        }

        .warning.danger {
            background: #fef2f2;
            border-left-color: var(--danger);
            color: #991b1b;
        }

        .warning-title {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-icon {
            font-size: 1.3em;
        }

        .recommendation {
            padding: 16px 20px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(52, 211, 153, 0.05) 100%);
            border-radius: 10px;
            margin-top: 16px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .recommendation strong {
            color: var(--primary);
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 24px 0;
        }

        .nutrition-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .nutrition-item:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
        }

        .nutrition-item strong {
            display: block;
            font-size: 1.5em;
            color: var(--primary);
            margin-bottom: 4px;
            font-weight: 600;
        }

        .nutrition-item span {
            font-size: 0.85em;
            color: var(--text-light);
        }

        #mealList {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            min-height: 100px;
        }

        .meal-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            background: white;
        }

        .meal-list-item:last-child {
            border-bottom: none;
        }

        .meal-list-item:hover {
            background: #f9fafb;
        }

        .meal-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .meal-emoji {
            font-size: 1.8em;
        }

        .meal-details {
            flex: 1;
        }

        .meal-name {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .meal-calories {
            font-size: 0.9em;
            color: var(--text-light);
        }

        .meal-remove {
            background: white;
            color: #ef4444;
            border: 1px solid #fee2e2;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .meal-remove:hover {
            background: #fee2e2;
            border-color: #ef4444;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            opacity: 1;
            pointer-events: all;
        }

        body.modal-open {
            overflow: hidden;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        #video {
            width: 100%;
            border-radius: 12px;
            background: #000;
            margin: 20px 0;
        }

        #canvas {
            display: none;
        }

        .captured-image {
            max-width: 100%;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid var(--border);
        }

        .camera-controls {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .camera-controls .btn {
            flex: 1;
        }

        .loader {
            border: 2px solid #f0f0f0;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 0.8s linear infinite;
            margin: 24px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .scanning-text {
            color: var(--text-light);
            font-size: 0.95em;
            margin-top: 16px;
        }

        .footer {
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.5) 0%, rgba(255, 255, 255, 0.95) 100%);
            color: var(--text-light);
            text-align: center;
            padding: 40px;
            border-top: 1px solid var(--border);
            font-size: 0.85em;
        }

        .footer p {
            margin: 4px 0;
        }

        .footer strong {
            color: var(--primary);
        }

        h2 {
            font-size: 1.4em;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 16px;
        }

        h3 {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 12px;
        }

        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 8px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 20px;
            }

            .content {
                padding: 24px;
            }

            .header {
                padding: 40px 24px 24px;
            }

            .camera-options {
                grid-template-columns: 1fr;
            }

            .nutrition-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 24px;
            }

            .user-info {
                position: static;
                margin: 20px auto;
                width: fit-content;
            }
        }
    </style>
</head>
<body>
    <div class="food-bg">
        <div class="food-item">ü•ó</div>
        <div class="food-item">üçé</div>
        <div class="food-item">ü•ë</div>
        <div class="food-item">ü•ï</div>
        <div class="food-item">üçå</div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">ü§ñ</div>
                <h1>Welcome to CaloTrack AI</h1>
                <p>Powered by Google Gemini Vision</p>
            </div>

            <div class="login-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">Sign In</button>
                    <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
                </div>

                <form id="login-form" class="auth-form active" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="login-email" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="login-password" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn">Sign In</button>
                    <div class="info-box">
                        <strong>Demo Account:</strong><br>
                        Email: demo@calotrack.com<br>
                        Password: demo123
                    </div>
                </form>

                <form id="signup-form" class="auth-form" onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="signup-name" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="signup-email" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signup-password" placeholder="Create a password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="signup-confirm" placeholder="Confirm your password" required>
                    </div>
                    <button type="submit" class="btn">Create Account</button>
                    <div class="info-box">
                        <strong>üìù Note:</strong> Your data is stored locally on your device for privacy and security.
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app">
        <div class="container">
            <div class="header">
                <div class="user-info">
                    <span>üë§ <strong id="current-user"></strong></span>
                    <button class="logout-btn" onclick="handleLogout()">Logout</button>
                </div>
                <div class="logo">ü§ñ</div>
                <h1>CaloTrack AI<span class="ai-badge">üß† Gemini Vision</span></h1>
                <p>AI-powered food recognition and health tracking</p>
                <div class="health-badge">
                    <span>üåø</span>
                    <span>Smart Nutrition Analysis</span>
                </div>
            </div>

            <div class="content">
                <div class="tabs">
                    <button class="tab active" onclick="showTab('scanner')">AI Scanner</button>
                    <button class="tab" onclick="showTab('profile')">Profile</button>
                    <button class="tab" onclick="showTab('tracker')">Tracker</button>
                </div>

                <!-- AI Scanner Tab -->
                <div id="scanner-tab" class="tab-content active">
                    <div class="section">
                        <h2 class="section-title">AI Food Scanner</h2>
                        <p class="section-subtitle">Use Google Gemini AI to identify food with high accuracy</p>

                        <div id="profile-check" class="profile-reminder">
                            <strong>üîí Health Profile Active:</strong> 
                            <span id="condition-display">Please set up your profile first</span>
                        </div>

                        <div class="camera-options">
                            <div class="camera-option" onclick="checkProfileAndScan('camera')">
                                <div class="camera-option-icon">üì∑</div>
                                <h3>Camera</h3>
                                <p>Take a photo</p>
                            </div>
                            <div class="camera-option" onclick="checkProfileAndScan('upload')">
                                <div class="camera-option-icon">üñºÔ∏è</div>
                                <h3>Upload</h3>
                                <p>Choose image</p>
                            </div>
                        </div>

                        <input type="file" id="fileInput" accept="image/*" onchange="handleFileUpload(event)">
                        <div id="scan-results" class="results"></div>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div id="profile-tab" class="tab-content">
                    <div class="section">
                        <h2 class="section-title">Health Profile</h2>
                        <p class="section-subtitle">Configure your health metrics for personalized warnings</p>
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="userName" placeholder="Enter your name">
                        </div>
                        <div class="form-group">
                            <label>Age</label>
                            <input type="number" id="age" placeholder="Years">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select id="gender">
                                <option value="">Select</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Height (cm)</label>
                            <input type="number" id="height" placeholder="170">
                        </div>
                        <div class="form-group">
                            <label>Weight (kg)</label>
                            <input type="number" id="weight" placeholder="65">
                        </div>
                        <div class="form-group">
                            <label>Medical Condition (Important for Food Warnings)</label>
                            <select id="condition">
                                <option value="None">None</option>
                                <option value="Diabetes">Diabetes</option>
                                <option value="Hypertension">Hypertension (High Blood Pressure)</option>
                                <option value="Heart Disease">Heart Disease</option>
                            </select>
                        </div>
                        <button class="btn" onclick="calculateBMI()">Save Profile & Calculate Metrics</button>
                        <div id="bmi-results" class="results"></div>
                    </div>
                </div>

                <!-- Tracker Tab -->
                <div id="tracker-tab" class="tab-content">
                    <div class="section">
                        <h2 class="section-title">Daily Tracker</h2>
                        <p class="section-subtitle">Monitor your daily calorie intake</p>
                        <div class="stat-card">
                            <h3 id="totalCalories">0</h3>
                            <p>Calories Today</p>
                        </div>
                        <h3 style="margin-top: 32px; margin-bottom: 16px;">Today's Meals</h3>
                        <div id="mealList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìä</div>
                                <p>No meals tracked yet</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer">
                <p><strong>CaloTrack AI</strong> ‚Äî Powered by Google Gemini Vision</p>
                <p>High School ICT Project 2026</p>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content" id="modalBody"></div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        // ============================================
        // üîë GOOGLE GEMINI API KEY
        // ============================================
        // IMPORTANT: Replace this with your own API key from:
        // https://aistudio.google.com/app/apikey
        // 
        // Get your FREE API key:
        // 1. Visit the link above
        // 2. Sign in with Google
        // 3. Click "Create API key"
        // 4. Copy and paste it below
        const GEMINI_API_KEY = 'YOUR_API_KEY_HERE';
        // ============================================

        // Global state
        let currentUser = null;
        let stream = null;
        let capturedImageData = null;
        let userData = { condition: 'None', dailyCalories: 2000, name: '' };
        let meals = [];
        let totalCals = 0;

        // Food database with nutritional info
        const foods = {
            'chicken adobo': {
                name: 'Chicken Adobo', emoji: 'üçó', calories: 290, carbs: 8, protein: 32, fat: 15, sodium: 680, sugar: 3,
                warnings: {
                    'Diabetes': { level: 'safe', message: 'SAFE TO EAT', detail: 'Good protein.', recommendation: 'Enjoy!' },
                    'Hypertension': { level: 'warning', message: 'EAT LESS', detail: '680mg sodium.', recommendation: 'Limit portion.' },
                    'Heart Disease': { level: 'safe', message: 'SAFE TO EAT', detail: 'Balanced meal.', recommendation: 'Remove skin.' },
                    'None': { level: 'safe', message: 'HEALTHY CHOICE', detail: 'Traditional dish.', recommendation: 'Enjoy!' }
                }
            },
            'white rice': {
                name: 'White Rice', emoji: 'üçö', calories: 205, carbs: 45, protein: 4, fat: 0.4, sodium: 2, sugar: 0,
                warnings: {
                    'Diabetes': { level: 'warning', message: 'EAT LESS', detail: '45g carbs.', recommendation: 'Limit to 1/2 cup.' },
                    'Hypertension': { level: 'safe', message: 'SAFE', detail: 'Low sodium.', recommendation: 'Safe!' },
                    'Heart Disease': { level: 'safe', message: 'SAFE', detail: 'Low fat.', recommendation: 'Good choice.' },
                    'None': { level: 'safe', message: 'GOOD', detail: 'Staple food.', recommendation: 'Enjoy!' }
                }
            },
            'rice': {
                name: 'White Rice', emoji: 'üçö', calories: 205, carbs: 45, protein: 4, fat: 0.4, sodium: 2, sugar: 0,
                warnings: {
                    'Diabetes': { level: 'warning', message: 'EAT LESS', detail: '45g carbs.', recommendation: 'Limit to 1/2 cup.' },
                    'Hypertension': { level: 'safe', message: 'SAFE', detail: 'Low sodium.', recommendation: 'Safe!' },
                    'Heart Disease': { level: 'safe', message: 'SAFE', detail: 'Low fat.', recommendation: 'Good choice.' },
                    'None': { level: 'safe', message: 'GOOD', detail: 'Staple food.', recommendation: 'Enjoy!' }
                }
            },
            'banana': {
                name: 'Banana', emoji: 'üçå', calories: 105, carbs: 27, protein: 1, fat: 0.4, sodium: 1, sugar: 14,
                warnings: {
                    'Diabetes': { level: 'warning', message: 'MODERATION', detail: '14g sugar.', recommendation: 'Limit to 1/2.' },
                    'Hypertension': { level: 'safe', message: 'EXCELLENT', detail: 'High potassium!', recommendation: 'Great!' },
                    'Heart Disease': { level: 'safe', message: 'HEALTHY', detail: 'Heart-friendly.', recommendation: 'Excellent!' },
                    'None': { level: 'safe', message: 'HEALTHY', detail: 'Nutritious.', recommendation: 'Great snack!' }
                }
            },
            'pizza': {
                name: 'Pizza', emoji: 'üçï', calories: 285, carbs: 36, protein: 12, fat: 10, sodium: 640, sugar: 4,
                warnings: {
                    'Diabetes': { level: 'warning', message: 'EAT LESS', detail: 'High carbs.', recommendation: 'Limit to 1 slice.' },
                    'Hypertension': { level: 'danger', message: '‚ö†Ô∏è LIMIT', detail: '640mg sodium!', recommendation: 'Avoid.' },
                    'Heart Disease': { level: 'warning', message: 'AVOID', detail: 'High fat/sodium.', recommendation: 'Choose healthier.' },
                    'None': { level: 'warning', message: 'OCCASIONAL', detail: 'High calories.', recommendation: 'Rare treat.' }
                }
            },
            'ice cream': {
                name: 'Ice Cream', emoji: 'üç®', calories: 207, carbs: 24, protein: 4, fat: 11, sodium: 80, sugar: 21,
                warnings: {
                    'Diabetes': { level: 'danger', message: '‚ùå DO NOT EAT', detail: 'Contains 21g of sugar!', recommendation: 'AVOID completely.' },
                    'Hypertension': { level: 'warning', message: 'EAT LESS', detail: 'High in saturated fat.', recommendation: 'Limit portions.' },
                    'Heart Disease': { level: 'danger', message: '‚ö†Ô∏è AVOID', detail: '11g fat.', recommendation: 'Choose sorbet instead.' },
                    'None': { level: 'warning', message: 'LIMIT CONSUMPTION', detail: 'High sugar.', recommendation: 'Treat food only.' }
                }
            },
            'soft drink': {
                name: 'Soft Drink', emoji: 'ü•§', calories: 139, carbs: 35, protein: 0, fat: 0, sodium: 15, sugar: 35,
                warnings: {
                    'Diabetes': { level: 'danger', message: '‚ùå NEVER', detail: '35g sugar!', recommendation: 'NEVER drink.' },
                    'Hypertension': { level: 'warning', message: 'AVOID', detail: 'High sugar.', recommendation: 'Drink water.' },
                    'Heart Disease': { level: 'danger', message: '‚ùå DO NOT', detail: 'Empty calories.', recommendation: 'Switch to water.' },
                    'None': { level: 'warning', message: 'UNHEALTHY', detail: 'No nutrition.', recommendation: 'Choose water.' }
                }
            },
            'burger': {
                name: 'Burger', emoji: 'üçî', calories: 354, carbs: 32, protein: 17, fat: 17, sodium: 497, sugar: 6,
                warnings: {
                    'Diabetes': { level: 'warning', message: 'EAT LESS', detail: 'High carbs and fat.', recommendation: 'Limit to small size.' },
                    'Hypertension': { level: 'warning', message: 'MODERATE', detail: '497mg sodium.', recommendation: 'Skip the fries.' },
                    'Heart Disease': { level: 'warning', message: 'LIMIT', detail: '17g fat.', recommendation: 'Choose grilled chicken.' },
                    'None': { level: 'warning', message: 'OCCASIONAL', detail: 'High calories.', recommendation: 'Treat meal.' }
                }
            },
            'salad': {
                name: 'Salad', emoji: 'ü•ó', calories: 52, carbs: 8, protein: 3, fat: 1, sodium: 89, sugar: 4,
                warnings: {
                    'Diabetes': { level: 'safe', message: 'EXCELLENT', detail: 'Low carbs, high fiber.', recommendation: 'Perfect choice!' },
                    'Hypertension': { level: 'safe', message: 'HEALTHY', detail: 'Low sodium.', recommendation: 'Great!' },
                    'Heart Disease': { level: 'safe', message: 'EXCELLENT', detail: 'Heart-healthy.', recommendation: 'Perfect!' },
                    'None': { level: 'safe', message: 'VERY HEALTHY', detail: 'Nutritious and low calorie.', recommendation: 'Eat more!' }
                }
            },
            'apple': {
                name: 'Apple', emoji: 'üçé', calories: 95, carbs: 25, protein: 0.5, fat: 0.3, sodium: 2, sugar: 19,
                warnings: {
                    'Diabetes': { level: 'safe', message: 'GOOD', detail: 'High fiber balances sugar.', recommendation: 'Enjoy!' },
                    'Hypertension': { level: 'safe', message: 'EXCELLENT', detail: 'Heart-healthy.', recommendation: 'Great snack!' },
                    'Heart Disease': { level: 'safe', message: 'HEALTHY', detail: 'Low fat, high fiber.', recommendation: 'Perfect!' },
                    'None': { level: 'safe', message: 'VERY HEALTHY', detail: 'Packed with vitamins.', recommendation: 'Eat daily!' }
                }
            }
        };

        // Authentication functions
        function setupDemoAccount() {
            const demoUser = {
                email: 'demo@calotrack.com',
                password: 'demo123',
                name: 'Demo User',
                profile: {}
            };
            
            try {
                const existing = localStorage.getItem('users');
                let users = existing ? JSON.parse(existing) : [];
                users = users.filter(u => u.email !== 'demo@calotrack.com');
                users.push(demoUser);
                localStorage.setItem('users', JSON.stringify(users));
            } catch (e) {
                localStorage.clear();
                localStorage.setItem('users', JSON.stringify([demoUser]));
            }
        }

        function checkAuth() {
            const session = localStorage.getItem('currentSession');
            if (session) {
                try {
                    currentUser = JSON.parse(session);
                    showMainApp();
                } catch (e) {
                    localStorage.removeItem('currentSession');
                }
            }
        }

        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('login-form').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('signup-form').classList.add('active');
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value.trim().toLowerCase();
            const password = document.getElementById('login-password').value;
            
            let users = [];
            try {
                users = JSON.parse(localStorage.getItem('users') || '[]');
            } catch (e) {
                setupDemoAccount();
                users = JSON.parse(localStorage.getItem('users') || '[]');
            }
            
            const user = users.find(u => u.email.toLowerCase() === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentSession', JSON.stringify(user));
                showMainApp();
            } else {
                alert('‚ùå Invalid email or password!\n\n‚úÖ DEMO ACCOUNT:\nEmail: demo@calotrack.com\nPassword: demo123');
            }
        }

        function handleSignup(event) {
            event.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value.trim().toLowerCase();
            const password = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm').value;
            
            if (password !== confirm) {
                alert('‚ùå Passwords do not match!');
                return;
            }
            
            if (password.length < 6) {
                alert('‚ùå Password must be at least 6 characters!');
                return;
            }
            
            let users = JSON.parse(localStorage.getItem('users') || '[]');
            
            if (users.find(u => u.email.toLowerCase() === email)) {
                alert('‚ùå Email already registered!');
                switchAuthTab('login');
                return;
            }
            
            const newUser = { email, password, name, profile: {} };
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            alert('‚úÖ Account created successfully!');
            switchAuthTab('login');
            document.getElementById('login-email').value = email;
        }

        function showMainApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            document.getElementById('current-user').textContent = currentUser.name;
            
            if (currentUser.profile && currentUser.profile.name) {
                loadUserProfile(currentUser.profile);
            }
            
            updateTracker();
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                saveUserProfile();
                localStorage.removeItem('currentSession');
                location.reload();
            }
        }

        function saveUserProfile() {
            if (!currentUser) return;
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.email === currentUser.email);
            
            if (userIndex !== -1) {
                users[userIndex].profile = {...userData};
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        function loadUserProfile(profile) {
            userData = {...profile};
            
            if (profile.name) document.getElementById('userName').value = profile.name;
            if (profile.age) document.getElementById('age').value = profile.age;
            if (profile.gender) document.getElementById('gender').value = profile.gender;
            if (profile.height) document.getElementById('height').value = profile.height;
            if (profile.weight) document.getElementById('weight').value = profile.weight;
            if (profile.condition) document.getElementById('condition').value = profile.condition;
            
            updateProfileDisplay();
        }

        // UI functions
        function updateProfileDisplay() {
            const display = document.getElementById('condition-display');
            if (userData.name && userData.condition) {
                if (userData.condition === 'None') {
                    display.innerHTML = `${userData.name} (No conditions)`;
                } else {
                    display.innerHTML = `${userData.name} (${userData.condition})`;
                }
            } else {
                display.innerHTML = 'Please set up your profile first';
            }
        }

        function checkProfileAndScan(method) {
            if (!userData.name) {
                alert('‚ö†Ô∏è Please set up your Health Profile first!');
                showTab('profile');
                return;
            }
            
            if (GEMINI_API_KEY === 'YOUR_API_KEY_HERE') {
                alert('‚ö†Ô∏è Please configure your Gemini API key!\n\nEdit the source code and replace YOUR_API_KEY_HERE with your actual API key from:\nhttps://aistudio.google.com/app/apikey');
                return;
            }
            
            if (method === 'camera') openCamera();
            else document.getElementById('fileInput').click();
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                if (tab.textContent.toLowerCase().includes(tabName)) {
                    tab.classList.add('active');
                }
            });
        }

        // Camera functions
        async function openCamera() {
            const modal = document.getElementById('modal');
            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <h2>Camera</h2>
                <video id="video" autoplay playsinline></video>
                <div class="camera-controls">
                    <button class="btn" onclick="capturePhoto()">Capture</button>
                    <button class="btn btn-outline" onclick="closeCamera()">Cancel</button>
                </div>
            `;
            modal.classList.add('active');

            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                document.getElementById('video').srcObject = stream;
            } catch (error) {
                modalBody.innerHTML = `<h2>Camera Access Required</h2><p>Please allow camera access.</p><button class="btn btn-outline" onclick="closeCamera()">Close</button>`;
            }
        }

        function capturePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            capturedImageData = canvas.toDataURL('image/jpeg', 0.8);

            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }

            document.getElementById('modalBody').innerHTML = `
                <h2>Photo Captured</h2>
                <img src="${capturedImageData}" class="captured-image">
                <div class="camera-controls">
                    <button class="btn" onclick="analyzeWithGemini()">Analyze with AI</button>
                    <button class="btn btn-outline" onclick="openCamera()">Retake</button>
                </div>
            `;
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    capturedImageData = e.target.result;
                    const modal = document.getElementById('modal');
                    document.getElementById('modalBody').innerHTML = `
                        <h2>Photo Selected</h2>
                        <img src="${capturedImageData}" class="captured-image">
                        <div class="camera-controls">
                            <button class="btn" onclick="analyzeWithGemini()">Analyze with AI</button>
                            <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
                        </div>
                    `;
                    modal.classList.add('active');
                };
                reader.readAsDataURL(file);
            }
        }

        function closeCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            closeModal();
        }

        function closeModal() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            const modal = document.getElementById('modal');
            modal.classList.remove('active');
            document.getElementById('modalBody').innerHTML = '';
            capturedImageData = null;
            document.body.style.overflow = 'auto';
        }

        // Google Gemini AI Analysis
        async function analyzeWithGemini() {
            document.getElementById('modalBody').innerHTML = `
                <h2>ü§ñ AI Analyzing Food</h2>
                <img src="${capturedImageData}" class="captured-image" style="opacity: 0.3;">
                <div class="loader"></div>
                <p class="scanning-text">Google Gemini AI is analyzing your image...</p>
            `;

            try {
                const base64Data = capturedImageData.split(',')[1];
                
                console.log('Sending request to Gemini API...');
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {
                                    text: "Identify the main food item in this image. Respond with ONLY the food name in lowercase (e.g., 'pizza', 'banana', 'rice', 'salad'). If multiple foods are present, identify the main/largest one. Be specific but concise."
                                },
                                {
                                    inline_data: {
                                        mime_type: "image/jpeg",
                                        data: base64Data
                                    }
                                }
                            ]
                        }]
                    })
                });

                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Full API response:', data);
                
                // Check for API error
                if (data.error) {
                    throw new Error(`API Error: ${data.error.message || 'Unknown error'}`);
                }
                
                // Check if response has the expected structure
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status} - ${data.error?.message || 'Request failed'}`);
                }
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const foodName = data.candidates[0].content.parts[0].text.trim().toLowerCase();
                    console.log('Gemini detected:', foodName);
                    
                    let matchedFood = null;
                    for (let key in foods) {
                        if (foodName.includes(key) || key.includes(foodName)) {
                            matchedFood = key;
                            break;
                        }
                    }
                    
                    if (matchedFood) {
                        showResults(matchedFood, foodName);
                    } else {
                        document.getElementById('modalBody').innerHTML = `
                            <h2>Food Identified: ${foodName}</h2>
                            <img src="${capturedImageData}" class="captured-image" style="max-height: 200px;">
                            <div class="warning warning">
                                <div class="warning-title">
                                    <span class="warning-icon">‚ÑπÔ∏è</span>
                                    Not in Database
                                </div>
                                <p>Gemini AI identified this as "${foodName}", but it's not in our nutritional database yet.</p>
                            </div>
                            <div class="recommendation">
                                <strong>üí° Tip:</strong> Try common foods like rice, chicken, pizza, salad, banana, or apple.
                            </div>
                            <button class="btn btn-outline" onclick="closeModal()">Close</button>
                        `;
                    }
                } else {
                    console.error('Unexpected response structure:', data);
                    throw new Error('Gemini API returned an unexpected response format. Check console for details.');
                }
                
            } catch (error) {
                console.error('Gemini API Error:', error);
                
                let errorMessage = error.message;
                let troubleshootingSteps = '';
                
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMessage = 'Network error - Could not connect to Gemini API';
                    troubleshootingSteps = `
                        <div style="text-align: left; margin-top: 16px; font-size: 0.85em;">
                            <strong>Troubleshooting:</strong><br>
                            ‚Ä¢ Check your internet connection<br>
                            ‚Ä¢ Make sure you're not behind a strict firewall<br>
                            ‚Ä¢ Try disabling browser extensions
                        </div>
                    `;
                } else if (error.message.includes('API_KEY_INVALID') || error.message.includes('400')) {
                    errorMessage = 'Invalid API Key';
                    troubleshootingSteps = `
                        <div style="text-align: left; margin-top: 16px; font-size: 0.85em;">
                            <strong>Fix:</strong><br>
                            1. Get a valid API key from:<br>
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--primary);">https://aistudio.google.com/app/apikey</a><br>
                            2. Open the HTML file in a text editor<br>
                            3. Replace 'YOUR_API_KEY_HERE' with your key<br>
                            4. Save and reload the page
                        </div>
                    `;
                } else if (error.message.includes('PERMISSION_DENIED') || error.message.includes('403')) {
                    errorMessage = 'API Key lacks permission or quota exceeded';
                    troubleshootingSteps = `
                        <div style="text-align: left; margin-top: 16px; font-size: 0.85em;">
                            <strong>Possible causes:</strong><br>
                            ‚Ä¢ API key doesn't have Gemini API enabled<br>
                            ‚Ä¢ Daily quota exceeded (free tier: 1500/day)<br>
                            ‚Ä¢ API key is restricted to specific websites
                        </div>
                    `;
                }
                
                document.getElementById('modalBody').innerHTML = `
                    <h2>‚ö†Ô∏è Analysis Error</h2>
                    <div class="warning danger">
                        <div class="warning-title">
                            <span class="warning-icon">‚ùå</span>
                            AI Analysis Failed
                        </div>
                        <p><strong>Error:</strong> ${errorMessage}</p>
                        ${troubleshootingSteps}
                    </div>
                    <div class="info-box" style="margin-top: 20px; text-align: left;">
                        <strong>üìã Debug Info:</strong><br>
                        API Key configured: ${GEMINI_API_KEY !== 'YOUR_API_KEY_HERE' ? 'Yes' : 'No'}<br>
                        Check browser console (F12) for more details
                    </div>
                    <div class="camera-controls">
                        <button class="btn btn-outline" onclick="openCamera()">Try Again</button>
                        <button class="btn btn-outline" onclick="closeModal()">Close</button>
                    </div>
                `;
            }
        }

        function showResults(foodKey, detectedName) {
            const food = foods[foodKey];
            const warningInfo = food.warnings[userData.condition];

            document.getElementById('modalBody').innerHTML = `
                <h2>‚úÖ Analysis Complete</h2>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">AI detected: ${detectedName}</p>
                ${capturedImageData ? `<img src="${capturedImageData}" class="captured-image" style="max-height: 180px;">` : ''}
                <div style="font-size: 3em; margin: 20px 0;">${food.emoji}</div>
                <h3>${food.name}</h3>
                
                <div class="stat-card">
                    <h3>${food.calories}</h3>
                    <p>Calories</p>
                </div>

                <div class="warning ${warningInfo.level}">
                    <div class="warning-title">
                        <span class="warning-icon">${warningInfo.level === 'danger' ? 'üö´' : warningInfo.level === 'warning' ? '‚ö†Ô∏è' : '‚úÖ'}</span>
                        ${warningInfo.message}
                    </div>
                    <p>${warningInfo.detail}</p>
                </div>

                <div class="recommendation">
                    <strong>üí° Recommendation:</strong><br>
                    ${warningInfo.recommendation}
                </div>

                <div class="nutrition-grid">
                    <div class="nutrition-item"><strong>${food.carbs}g</strong><span>Carbs</span></div>
                    <div class="nutrition-item"><strong>${food.protein}g</strong><span>Protein</span></div>
                    <div class="nutrition-item"><strong>${food.fat}g</strong><span>Fat</span></div>
                    <div class="nutrition-item"><strong>${food.sodium}mg</strong><span>Sodium</span></div>
                </div>

                ${warningInfo.level !== 'danger' ? `
                    <button class="btn" onclick="addToTracker('${foodKey}')">Add to Tracker</button>
                ` : `
                    <button class="btn" style="background: #999;" disabled>‚ö†Ô∏è Not Safe for Your Condition</button>
                `}
                <button class="btn btn-outline btn-small" onclick="closeModal()" style="margin-top: 12px;">Close</button>
            `;

            document.getElementById('scan-results').innerHTML = document.getElementById('modalBody').innerHTML;
            document.getElementById('scan-results').classList.add('active');
        }

        // Tracker functions
        function addToTracker(foodKey) {
            const food = foods[foodKey];
            meals.push(food);
            totalCals += food.calories;
            updateTracker();
            closeModal();
            
            setTimeout(() => {
                showTab('tracker');
                alert(`‚úÖ ${food.name} added to your tracker!`);
            }, 100);
        }

        function updateTracker() {
            document.getElementById('totalCalories').textContent = totalCals;
            const mealList = document.getElementById('mealList');
            
            if (meals.length === 0) {
                mealList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <p>No meals tracked yet</p>
                    </div>
                `;
                return;
            }

            let html = '<div style="padding: 0;">';
            meals.forEach((meal, i) => {
                html += `
                    <div class="meal-list-item">
                        <div class="meal-info">
                            <span class="meal-emoji">${meal.emoji}</span>
                            <div class="meal-details">
                                <div class="meal-name">${meal.name}</div>
                                <div class="meal-calories">${meal.calories} calories</div>
                            </div>
                        </div>
                        <button class="meal-remove" onclick="removeMeal(${i})">‚úï Remove</button>
                    </div>
                `;
            });
            html += '</div>';
            mealList.innerHTML = html;
        }

        function removeMeal(index) {
            totalCals -= meals[index].calories;
            meals.splice(index, 1);
            updateTracker();
        }

        // BMI Calculator
        function calculateBMI() {
            const name = document.getElementById('userName').value;
            const age = parseInt(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const condition = document.getElementById('condition').value;

            if (!name || !age || !gender || !height || !weight) {
                alert('Please fill in all fields');
                return;
            }

            const heightM = height / 100;
            const bmi = (weight / (heightM * heightM)).toFixed(1);
            const bmr = gender === 'Male' 
                ? 10 * weight + 6.25 * height - 5 * age + 5 
                : 10 * weight + 6.25 * height - 5 * age - 161;
            const dailyCalories = Math.round(bmr * 1.375);

            userData = { name, condition, dailyCalories, age, gender, height, weight };
            saveUserProfile();
            updateProfileDisplay();

            let category, color;
            if (bmi < 18.5) { category = 'Underweight'; color = '#f59e0b'; }
            else if (bmi < 25) { category = 'Normal'; color = '#10b981'; }
            else if (bmi < 30) { category = 'Overweight'; color = '#f59e0b'; }
            else { category = 'Obese'; color = '#ef4444'; }

            document.getElementById('bmi-results').innerHTML = `
                <div class="stat-card" style="background: ${color};"><h3>BMI ${bmi}</h3><p>${category}</p></div>
                <div class="stat-card"><h3>${dailyCalories}</h3><p>Daily Target</p></div>
                <div class="warning success"><strong>‚úÖ Saved!</strong></div>
            `;
            document.getElementById('bmi-results').classList.add('active');
        }

        // Initialization
        setupDemoAccount();
        checkAuth();
        updateProfileDisplay();
    </script>
</body>
</html>